{% extends "ca/layout.html" %}

{% block page_title %}Settings - CA Workspace{% endblock %}
{% block page_header %}Settings{% endblock %}
{% block page_subtitle %}Manage your account preferences{% endblock %}

{% block extra_page_css %}
<style>
    .settings-grid { display: grid; gap: var(--space-4); max-width: 900px; }
    .settings-section { background: rgba(255,255,255,0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); border-radius: var(--border-radius-lg); padding: var(--space-4); }
    .settings-section-title { font-size: var(--font-size-lg); font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-3); padding-bottom: var(--space-2); border-bottom: 1px solid rgba(255,255,255,0.08); }
    .form-group { display: grid; gap: var(--space-1); margin-bottom: var(--space-3); }
    .form-label { font-size: var(--font-size-sm); font-weight: 500; color: var(--text-secondary); }
    .form-input { padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: var(--border-radius-md); color: var(--text-primary); font-size: var(--font-size-sm); }
    .form-input:focus { outline: none; border-color: var(--accent-gold); }
</style>
{% endblock %}

{% block page_content %}
<div class="settings-grid">
    <div class="settings-section">
        <h2 class="settings-section-title">Profile Information</h2>
        <form id="profileForm">
            <div class="form-group">
                <label class="form-label">First Name</label>
                <input type="text" class="form-input" id="firstName" value="{{ current_user.first_name or '' }}">
            </div>
            <div class="form-group">
                <label class="form-label">Last Name</label>
                <input type="text" class="form-input" id="lastName" value="{{ current_user.last_name or '' }}">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" value="{{ current_user.email }}" disabled>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('profileForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const supabase = window.supabase;
    const caId = window.CA_ID;
    
    try {
        const { error } = await supabase
            .from('users')
            .update({
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value
            })
            .eq('id', caId);
        
        if (error) throw error;
        alert('Profile updated');
    } catch (error) {
        alert('Failed to update profile');
    }
});
</script>
{% endblock %}
